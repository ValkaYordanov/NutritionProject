@model IEnumerable<NutritionApp.Models.Intake>

@{
    ViewData["Title"] = "Overview";

    int prev = ViewBag.Count + 1;
    int next = ViewBag.Count - 1;
    var day = ViewBag.theDay;
    var p = 1;


}

<div id="day">
    <h3>
        <a asp-action="Index" asp-route-id="@prev">Prev</a>
        <span>
            @{
                if (ViewBag.Count <= 0)
                {
                    @:Today
                }
                else if (ViewBag.Count == 1)
                {
                    @:Yesterday
                }
                else
                {
                    @ViewBag.theDay
                }
            }
        </span>
        @{ if (next >= 0)
            {
                <a asp-action="Index" asp-route-id="@next">Next</a>
            }
        }
    </h3>
</div>
<section class="overview-graphs">
    <div id="top">
        <div id="kcal-goal">
            <p>GOAL</p>
            <h4 class="goal">1906</h4>
            <p>kcal</p>
        </div>
        <div id="appleStyle">
            <p>EATEN</p>
            <input id="toggle" type="checkbox" />
            <label id="control" for="toggle"></label>
            <div id="container"></div>
        </div>
    </div>
    <div id="graphs">
        <div class="graph">
            <div class="bar-wrap kcal">
                <div class="bar"></div>
            </div>
            <div class="graph-text">
                <p>0</p>
                <span>Kcal</span>
            </div>
        </div>
        <div class="graph">
            <div class="bar-wrap carbs">
                <div class="bar"></div>
            </div>
            <div class="graph-text">
                <p>0</p>
                <span>Carbs</span>
            </div>
        </div>
        <div class="graph">
            <div class="bar-wrap fats">
                <div class="bar"></div>
            </div>
            <div class="graph-text">
                <p>0</p>
                <span>Fat</span>
            </div>
            </div>
                <div class="graph">
                    <div class="bar-wrap proteins">
                        <div class="bar"></div>
                    </div>
                    <div class="graph-text">
                        <p>0</p>
                        <span>Protein</span>
                    </div>
                </div>
            </div>

</section>

<table class="table">
    <thead>
        <tr>
            <th>
                Grams
            </th>
            <th>
                Product / Meal
            </th>
            <th>
                Kcal
            </th>
            <th></th>
        </tr>
    </thead>
    <tbody>
        @foreach (var item in Model)
        {

            <tr>
                <a asp-controller="Intakes" asp-action="Edit" asp-route-id="@item.IntakeId">
                    <td class="qnt">
                        @Html.DisplayFor(modelItem => item.Quantity)
                    </td>
                    <td class="name">

                        @Html.DisplayFor(modelItem => item.Meal.MealName)
                        @Html.DisplayFor(modelItem => item.Product.ProductName)
                    </td>
                    <td class="kcal-col" data-qnt="@Html.DisplayFor(modelItem => item.Quantity)" data-fat="@{
                            var i2 = 0;
                        }
                        @foreach (var listitem in ViewData["Fats"] as List<decimal>)
                        {
                            i2++;
                            @if (i2 == p)
                            {
                                    @listitem

                            }
                        }" data-carbs="@{
                            var i3 = 0;
                        }
                        @foreach (var listitem in ViewData["Carbs"] as List<decimal>)
                        {
                            i3++;
                            @if (i3 == p)
                            {
                                    @listitem
                            }
                        }" data-proteins="@{
                            var i4 = 0;
                        }
                        @foreach (var listitem in ViewData["Proteins"] as List<decimal>)
                        {
                            i4++;
                            @if (i4 == p)
                            {
                                    @listitem
                            }
                        }"
                        data-kcal="@{
                            var i5 = 0;
                        }
                        @foreach (var listitem in ViewData["KcalList"] as List<int>)
                        {
                            i5++;
                            @if (i5 == p)
                            {
                                    @listitem

                                        }
                        }

                        @{
                            p++;
                        }">

                        <p class="kcal"></p>

                    </td>

                </a>

            </tr>
        }


    </tbody>
</table>
<script>
    let kcalCol = document.querySelectorAll('.kcal-col');
    let kcalP = document.querySelectorAll('.kcal-col .kcal');
    let kcalBar = document.querySelector('.kcal .bar');
    let carbsBar = document.querySelector('.carbs .bar');
    let fatsBar = document.querySelector('.fats .bar');
    let proteinsBar = document.querySelector('.proteins .bar');
    const fatText = document.querySelector('.bar-wrap.fats ~ .graph-text p');
    const carbText = document.querySelector('.bar-wrap.carbs ~ .graph-text p');
    const proteinText = document.querySelector('.bar-wrap.proteins ~ .graph-text p');
    const kcalText = document.querySelector('.bar-wrap.kcal ~ .graph-text p');
    const kcalGoal = document.querySelector('#kcal-goal .goal')

    //let carbs = document.querySelectorAll('kcal-col');
    var totalProteins = 0;
    var totalFats = 0;
    var totalCarbs = 0;
    var totalKcal = 0;

    //get totals - looping through data
    for (i = 0; i < kcalCol.length; ++i) {
        var carbs = kcalCol[i].getAttribute('data-carbs');
        var fats = kcalCol[i].getAttribute('data-fat');
        var proteins = kcalCol[i].getAttribute('data-proteins');
        var kcal = kcalCol[i].getAttribute('data-kcal');
        var qnt = kcalCol[i].getAttribute('data-qnt');

        //totalKcal += parseInt(kcalCol[i].querySelector(".kcal").innerText);
        calqulatedKcal = Math.floor((parseFloat(kcal) / 100) * parseFloat(qnt));

        totalProteins += parseFloat(proteins);
        totalFats += parseFloat(fats);
        totalCarbs += parseFloat(carbs);
        totalKcal += calqulatedKcal;
        //show calculated kcal on frontend
        kcalCol[i].querySelector(".kcal").innerText = calqulatedKcal;
    }
    //show totals on frontend
    fatText.innerText = totalFats;
    proteinText.innerText = totalProteins;
    carbText.innerText = totalCarbs;
    kcalText.innerText = totalKcal;

    //calculate percantages
    var goal = parseInt(kcalGoal.innerText);
    var carbgoal = Math.floor((goal / 2) / 4);
    var carbPct = (totalCarbs / carbgoal) * 100;
    var kcalPct = ((totalKcal / goal) * 100);
    var fatPct = ((totalFats / 60) * 100);
    var proteinPct = ((totalProteins / 49) * 100);

    //show percentages in graph
    carbsBar.style.height = "" + carbPct + "%";
    fatsBar.style.height = "" + fatPct + "%";
    proteinsBar.style.height = "" + proteinPct + "%";
    kcalBar.style.height = "" + kcalPct + "%";

</script>
